<!DOCTYPE html>
<html>

<style>
.response{
border: 2px solid red;
width:50%;
display:block;
white-space: pre;
}
</style>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Crypto bridge</title>
</head>

<body>

<h1>Crypto bridge mobility</h1>


<button onclick="onClickReset()">reset</button>
<div class="response" id="reset"></div>
<button onclick="onClickProcess()">process next payment now</button>
<div class="response" id="process"></div>

<h2>latest trips</h2>

<div class="response" id="trips"></div>

<script type="text/javascript">

async function onClickReset() {
  if (window.confirm('This is a testnet only feature. Proceed?')) {
    const res = await fetch('/reset_trips')
    const resBody = await res.json()
    const div = document.getElementById("reset")
    div.innerHTML = JSON.stringify(resBody, null,2)
    // window.location.reload(false)
    await updateTrips()
  }
}

async function onClickProcess() {
  if (window.confirm('Pay next queued unpaid trip immediately?')) {
    const res = await fetch('/process_trips')
    const resBody = await res.json()
    const div = document.getElementById("process")
    div.innerHTML = JSON.stringify(resBody, null, 2)
    await updateTrips()
  }
}


async function getTrips() {
  const opts = {
    'method': 'GET',
    headers: {
      'Content-Type': 'application/json',
    }
  }
  const res = await fetch('/trips', opts)
  const resBody = await res.json()
  return resBody
}

async function updateTrips() {
  const div = document.getElementById("trips")
  div.innerHTML = "loading trips..."
  const data = await getTrips()
  const str = JSON.stringify(data, null, 2)
  div.innerHTML = str

}

document.addEventListener("DOMContentLoaded", async () => {
  await updateTrips()
})

</script>

</body>
